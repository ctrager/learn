<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <link rel="stylesheet" href="select2.css" />
    <script src="jquery.js"></script>
    <script src="select2.js"></script>

    <style>
        body,
        div,
        select,
        button {
            font-size: 24px
        }

        #my_email_select {
            width: 200px;
        }
    </style>
    <script>

        $(document).ready(function () {
            start_email_select();
        });

        function handle_email_select_close() {

            selected_val = $("#my_email_select").val()

            if (selected_val != "") {
                new_val = $("#post_email_to").val();
                if (new_val == ""
                    || new_val.endsWith(",")
                    || new_val.endsWith(", ")) {
                    new_val += selected_val
                }
                else {
                    new_val += "," + selected_val
                }
                $("#post_email_to").val(new_val);
            }
            $("#my_email_select").next(".select2-container").hide();
        }

        function start_email_select() {
            // convert vanilla select to select 2
            $my_email_select = $("#my_email_select");
            $my_email_select.select2({
                // no options
            });

            // hide it - select2 creates another element, so 
            // hiding ours won't work
            $my_email_select.next(".select2-container").hide();

            // wire up event
            $my_email_select.on("select2:close", function (e) {
                handle_email_select_close();
            })
        }

        function open_email_select() {

            $my_email_select = $("#my_email_select");

            // clear it
            $my_email_select.val("").trigger("change");

            // unhide it
            $my_email_select.next(".select2-container").show();

            // open it
            $my_email_select.trigger("open");
        }


    </script>
</head>

<body>
    <div>hello</div>
    <div class="container">
        <input id="post_email_to" placeholder="johndoe@example.com"></input>
        <button onclick="open_email_select()">...</button>

        <select id="my_email_select">
            <option value="">[none]</option>
            <option value="a">Apple</option>
            <option value="b">Banana</option>
            <option value="c">Carrot</option>
        </select>

        <br>
        <div>
</body>

</html>